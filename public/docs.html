<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Gradescope Calendar</title>
        <meta charset="utf-8">
        <meta name="author" content="CoolSpy3">
        <meta name="description" content="Show Gradescope Assignments in Google Calendar">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="main.css">
        <script defer src="/__/firebase/10.4.0/firebase-app-compat.js"></script>
        <script defer src="/__/firebase/10.3.1/firebase-auth-compat.js"></script>
        <script defer src="/__/firebase/init.js?useEmulator=true"></script>
        <script defer src="/js/main.js"></script>
    </head>
    <body>
        <header>
            <a href="/"><h1>Gradescope Calendar</h1></a>
            <a id="login-button" href="/login">Signup / Login</a>
        </header>
        <div class="content">
            <h1>Documentation</h1>
            <p>Welcome to the docs page! This page will explain how to use this site as well as how it works.</p>
            <h2>How to use</h2>
            <h3>Logging In</h3>
            <p>To log in to the site, simply press the login button in the top corner of the screen</p>
            <img src="" alt="TODO">
            <p>
                You will then be prompted to log in with your Google account. If this is your first time logging in,
                you may also be prompted to log in again with the same account in order to authorize our server to
                access your Google Calendar. <a href="TODO">Why is this?</a>
            </p>
            <h3>Your Account Dashboard</h3>
            <img src="" alt="TODO">
            <p>
                Your account dashboard is where you can manage your account. The first thing you should do after creating
                your account is to press the button to link your Gradescope account. This will allow us to access your
                Gradescope assignments. (See: <a href="TODO">Linking Your Gradescope Account</a>) There are five other
                buttons on the page:
            </p>
            <h4>Refresh Course List</h4>
            <p>
                Gradescope Calendar does not automatically update your course list (<a href="TODO">Why is this?</a>).
                After you link your Gradescope account, you will need to press this button to load your course list from
                Gradescope. Gradescope Calendar will only load courses for which you are currently enrolled.
            </p>
            <h4>Update Calendar Events</h4>
            <p>
                Gradescope Calendar automatically fetches your assignments from Gradescope <a href="">TODO  times per day</a>.
                If you want to update your calendar immediately, you can press this button to force an update. Additionally,
                because <a href="TODO">we don't have a way to automatically inform you about problems with your account</a>,
                pressing this button will show a popup if an error occurs while updating your calendar.
            </p>
            <h4>Save Changes</h4>
            <p>
                This button saves any changes you've made to your settings. See: <a href="TODO">Settings</a>
            </p>
            <h4>Download My Data</h4>
            <p>
                This button downloads a copy of the available data we have about you. Note that for security reasons, some
                of your data (such as your Google/Gradescope account information) is not accessible from the client side,
                and therefore cannot be downloaded. See: <a href="TODO">Privacy Policy</a> and <a href="TODO">How is data stored?</a>
            </p>
            <h4>Delete My Account</h4>
            <p>
                This button deletes your account and all associated data from our servers. See: <a href="TODO">Privacy Policy</a>
            </p>
            <h4>Settings</h4>
            <p>
                The bulk of your account dashboard is the settings menu. It allows you to customize how Gradescope Calendar works for you.
                There are three settings you can change:
            </p>
            <h5>Calendar</h5>
            <p>
                This setting allows you to choose which Google calendar Gradescope Calendar will put your assignments in.
                You can select any calendar which you have write access to. Personally, I recommend
                <a href=https://support.google.com/calendar/answer/37095?hl=en/">creating a new calendar</a> specifically
                for Gradescope assignments, but you can use any calendar you want. If you do not select a calendar,
                Gradescope Calendar will not add any events to your calendar.
            </p>
            <h5>Completed Assignment Color</h5>
            <p>
                This setting allows you to choose the color of assignments that you have turned in. If you do not
                select a color, completed assignments will not be colored differently from incomplete assignments.
            </p>
            <h5>Course Colors</h5>
            <p>
                You can also choose the color of assignments for each course. To do so, select the color dropdown next
                to the course name. At the moment, you cannot not select a color for a course. If this feature is important
                to people, I can add it in the future.
            </p>
            <h3>Linking Your Gradescope Account</h3>
            <p>
                In order to access your Gradescope assignments, you must link your Gradescope account. To do so,
                press the "Link Gradescope Account" button on your account dashboard. Unsurprisingly, Gradescope is not
                thrilled about a random website accessing people's Gradescope accounts, so there's not a good way to
                log you in through Gradescope. Instead, you can log in to Gradescope through our site with one of two
                methods:
            </p>
            <h4>With a Gradescope Token (More Secure, More Difficult)</h4>
            <p>
                This method involves extracting your gradescope token from your browser's cookies and pasting it into
                our site. This method is more secure because it does not require you to enter your Gradescope password,
                so our site never has access to your password. However, it requires you to go through DevTools to get
                the token. To do so, follow these steps:
            </p>
            <ol> TODO: UPDATE THIS
                <li>Open Gradescope in your browser</li>
                <li>Open DevTools (Ctrl+Shift+I on Windows/Linux, Cmd+Shift+I on Mac)</li>
                <li>Go to the "Application" tab</li>
                <li>Expand the "Cookies" dropdown</li>
                <li>Click on "https://www.gradescope.com"</li>
                <li>Find the "token" cookie</li>
                <li>Copy the value of the cookie</li>
                <li>Paste the value into the Gradescope Token field on our site</li>
                <li>Press the "Link Gradescope Account" button</li>
            </ol>
            <h4>With Your Gradescope Username and Password (Less Secure, Easier)</h4>
            <p>
                This method involves entering your Gradescope username and password into our site. This method is less
                secure because it requires your Gradescope password to be sent to our backend for processing. (Browsers
                do not like it when you try to login to another site and send the results somewhere else.) To login
                with this method, simply enter your username and password into the appropriate fields and press the
                "Link Gradescope Account" button. This will send your username and password to our backend, which will
                then log in to Gradescope on your behalf and extract your token. These tokens typically expire after
                ~6 months, so you will need to re-link your account periodically. If our backend is able to detect the
                expiry date, it will allow you to put an event on your calendar to remind you to re-link your account.

                You are also given the option to store your credentials on our backend. If you choose to do so, our
                backend will store your username and password and use them to automatically re-link your account when
                your token expires. I don't recommend this because, while I've done my best to ensure our backend is secure,
                this website was programmed by a single programmer in his free time while learning the technologies,
                so there may be security vulnerabilities that I am unaware of. If you choose to store your credentials,
                you can delete them at any time by relinking your account and unchecking the "Store Credentials" box,
                linking your account with a token, or deleting your account.
            </p>
            <h5>My School Forces Me to Log In to Gradescope with School Credentials/Google</h5>
            <p>
                In my experience, even if your school forces you to log in to Gradescope with your school credentials,
                you can still add a password login to your account. To do so, follow these steps:
            </p>
            <ol> TODO: UPDATE THIS
                <li>Log in to Gradescope with your school credentials</li>
                <li>Go to your account settings</li>
                <li>Click "Add Password Login"</li>
                <li>Enter a password</li>
                <li>Log out of Gradescope</li>
                <li>Log in to Gradescope with your email and password</li>
            </ol>
            <h2>How the Site Works</h2>
            <p>
                This site is a frontend for a <a href="https://github.com/CoolSpy3/gradescope-calendar">Python script</a>
                I wrote to put my Gradescope Assignments onto my Google Calendar. This site simplifies the process of
                using the script by providing a web interface for linking your accounts and managing your settings.
                Additionally, some features of the site (such as the ability to update the due date of an assignment when
                it is changed on Gradescope) are not available in the standalone script.

            </p>
            <h3>Hosting</h3>
            <p>
                Ultimately, the site is hosted on <a href="https://firebase.google.com/">Google Firebase</a>, which provides
                an extensive enough free tier that I can host this site without too many API costs. Ideally, I would host
                the site on my own server, but I don't have the money to do so, and Google will likely provide better
                maintenance than I could. However, in order to make sure that I can continue to provide this service for
                free, I have set a $1 price cap on the remaining usage. If this site exceeds the usage cap, it will be
                shut down until the next month. Conversely, if this service goes mostly unused, I may decide to shut it
                down and/or stop maintaining it. Additionally, if this site becomes widely popular, I may have to look into
                adding a donation button to cover the hosting costs.

                In order to make sure that the site does not exceed the usage cap, I have done my best to optimise the
                site's backend to minimize API calls and backend processing. This means that I perform more processing
                in the browser than I would if I were hosting the site myself (you shouldn't notice anything though),
                I have chosen to not implement features which would require more backend support (ex. more frequent
                course/assignment fetching from Gradescope), and there are some places where I have neglected to implement
                more extensive user input checking/validation.

                I've tried to do this last part in a way where you should not notice any issues unless you are
                intentionally trying to break the site (Please don't. <a href="TODO">Test the site locally instead</a>).
                Even so, the backend is designed to isolate operations done on different accounts, so sending malformed
                data should only affect your user account.
            </p>
            <h3>How is Data Stored?</h3>
            <p>
                All data is stored in a <a href="https://firebase.google.com/docs/database">Firebase Realtime Database</a>.
                The database is structured into a couple sections depending on the type of data. Each of these then has
                separate "subsections" for each user. In every case, the backend has full read/write access to the database,
                and the accessible data on the frontend is limited to the data for the currently signed-in user.

                Sections with read access for signed-in users can be downloaded from the frontend by pressing the
                "Download My Data" button on the <a href="TODO">account dashboard</a>.
            </p>
            <h4>Assignment Cache</h4>
            <p>
                Access Control: Only accessible from backend

                This section of the database is used by the backend to keep track of what assignment's it's added to
                each user's calendar as well as the state of each assignment. This allows the backend to only send API
                calls to Google Calendar when necessary.
            </p>
            <h4>Auth Status</h4>
            <p>
                Access Control: Read-only for signed-in users

                This section of the database is used to keep track of which accounts (Google/Gradescope) are successfully
                linked to each user's account. This allows the frontend to display the correct information to the user.
            </p>
            <h4>Credentials</h4>
            <p>
                Access Control: Only accessible from backend

                This section of the database is used to store the token and credentials for each user's Gradescope account
                as well as the token issued by Google to access their calendar.
            </p>
            <h4>Settings</h4>
            <p>
                Access Control: Read-write for signed-in users

                This section of the database is used to store each user's settings. This allows the frontend to display
                the correct information and update it on request. It also allows the backend to know how to process each
                user's data. This is also where your course list is stored.
            </p>
            <h3>How it Works</h3>
            <p>
                Google Firebase places a limit on the runtime of backend functions, so in order to make sure that the
                backend is fast enough to scale (at least in the short-mid term), I've divided the backend into two
                main functions. One which fetches new data from Gradescope and one which updates the calendar. The
                two functions run TODO times per day offset from each other by 30 minutes (TODO EXPLAIN). The two functions
                communicate through the <a href="TODO">assignment cache</a>. This keeps track of which assignments each
                user has, their status, and whether they've been added to the calendar.

                The basic flow of the backend is as follows:
            </p>
            <h4>Fetching from Gradescope</h4>
            <p>
                In order to fetch data from Gradescope, the backend first enumerates the list of courses which have been
                associated with the given user (See: <a href="TODO">Update Course List</a>). For each course, it then
                retrieves the assignment's id, name, due date, and whether it's been turned in. It then compares this
                to the user's assignment cache. Firstly, any assignments in the cache which are not part of an active
                course and any assignments which are completed but not in the cache are discarded. Then, any assignments
                which are not in the cache are added to it. Finally, all assignments already in the cache are updated
                with the new data.
            </p>
            <h4>Updating the Calendar</h4>
            <p>
                In order to update the calendar, the backend first retrieves the user's assignment cache. It then
                runs through the list applying the following logic to each assignment:
            </p>
            <ol>
                <li>If the assignment is not associated with an event, a new event is created for it</li>
                <li>If the assignment is associated with an event and has been updated with new data, the event is updated</li>
                <li>If the assignment is marked as completed, it is removed from the cache</li>
            </ol>
          </div>
          <footer>
              <a href="/disclaimer">Disclaimer</a>
              <a href="/privacy-policy">Privacy Policy / Terms of Use</a>
              <a href="https://github.com/CoolSpy3/gradescope-calendar-web/">Contribute on GitHub</a>
          </footer>
    </body>
</html>
